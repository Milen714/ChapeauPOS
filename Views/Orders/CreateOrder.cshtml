@model ChapeauPOS.Models.Table
@{  
    ViewData["Title"] = $"Table: {Model.TableNumber} {Model.TableStatus.ToString()}";
    Layout = "~/Views/Shared/_OrderLayout.cshtml";
	ViewBag.TableNumber = Model.TableNumber;
    

}  
<h1>@ViewData["Title"]</h1>  
<input id="tableId" type="hidden" name="tableId" value="@Model.TableNumber" />
<input id="employeeId" type="hidden" name="employeeId" value="@ViewBag.LoggedInEmployee.EmployeeId" />
<input id="table" name="table" type="hidden" value="@Model.TableNumber">
<header>  
  <select id="mealType" onload="loadPartialView()" onchange="loadPartialView()">  
      <option value="Lunch">Lunch</option>  
      <option value="Dinner">Dinner</option>  
        
  </select>  
</header>  

<article class="OrderViewBody">
<div id="partialViewContainer">  
  <!-- Partial view will be loaded here -->  
</div>  

<div class="order_container">  
  <div class="order_items">
            <a href="/Orders/DeleteOrder/@Model.TableNumber">CancelOrder</a>

            <h2>Order Items</h2>  
	  <div id="orderList">  
		  <!-- Order items will be dynamically added here -->  
	  </div>
			@* <div id="order_total"> *@
				
			@* </div> *@
  </div>  
  
</article>

@section Scripts {  
  <script>  
      function loadPartialView() {  
          const selectedValue = document.getElementById('mealType').value;  
          const container = document.getElementById('partialViewContainer');  

          fetch(`/Orders/GetMenuItems?category=${selectedValue}`)  
              .then(response => {  
                  if (!response.ok) {  
                      throw new Error('Network response was not ok');  
                  }  
                  return response.text();  
              })  
              .then(html => {  
                  container.innerHTML = html;
                    filterCourse('starter');
                       // attachMenuItemClickHandlers();
              })  
              .catch(error => console.error('Error loading partial view:', error));  
      }  
          
      function filterCourse(course) {
            document.querySelectorAll('.menu-item').forEach(item => {
                item.style.display = item.dataset.course === course ? 'block' : 'none';
            });
        }


            $(document).ready(loadPartialView());

            $(document).ready(function () {
                var tableId = document.getElementById('tableId').value;
                $.ajax({
                    url: "/Orders/DisplayOrderView?tableId=" + encodeURIComponent(tableId),
                    type: "GET",
                    success: function (data) {
                        $("#orderList").html(data);
                    },
                    error: function (error) {
                        console.error("Error fetching users:", error);
                    }
                });
            });

            $(document).on('click', '.clickable-item', function () {
                const itemId = $(this).closest('.menu-item-form').find('.item-id').val();
                var tableId = document.getElementById('tableId').value;
                var employeeId = document.getElementById('employeeId').value;
                const note = $(this).closest('.menu-item-form').find('.note-input').val();
                $.ajax({
                    url: '/Orders/AddItemToOrder',
                    type: 'POST',
                    data: {
                        itemId: parseInt(itemId),
                        tableId: parseInt(tableId),
                        employeeId: parseInt(employeeId),
                        note: note
                    },
                    success: function (html) {
                        $('#orderList').html(html); // inject updated partial
                    },
                    error: function (xhr, status, error) {
                        console.error('AJAX error:', error);
                    }
                });
            });


                //  $(document).ready( function () {
                //           var table = document.getElementById('table').value;
                //     $.ajax({
                //           url: '/Orders/OrderTotal',
                //         type: 'POST',
                //         data: {
                //                 table: parseInt(table)
                //         },
                //         success: function (html) {
                //               $('#order_total').html(html); // inject updated partial
                //         },
                //         error: function (xhr, status, error) {
                //             console.error('AJAX error:', error);
                //         }
                //     });
                // });





                //     $(document).on('click', '.clickable-item', function () {
                //             var table = document.getElementById('table').value;
                //       $.ajax({
                //             url: '/Orders/OrderTotal',
                //           type: 'POST',
                //           data: {
                //                   table: parseInt(table)
                //           },
                //           success: function (html) {
                //                 $('#order_total').html(html); // inject updated partial
                //           },
                //           error: function (xhr, status, error) {
                //               console.error('AJAX error:', error);
                //           }
                //       });
                //   });

  </script>  
}
