@model ChapeauPOS.ViewModels.PaymentViewModel
@{
   <input id="tableId" type="hidden" name="tableId" value="@Model.Order.Table.TableNumber" />
}
<h2>Payment Summary - Table @Model.Order.Table.TableNumber</h2>
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">
        @TempData["Error"]
    </div>
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">
        @TempData["Success"]
    </div>
}
<div>
<table class="table">
    <thead>
        <tr>
            <th>Item</th>
            <th>Qty</th>
            <th>Unit Price</th>
            <th>Total</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model.Order.OrderItems)
        {
            <tr>
                <td>@item.MenuItem.ItemName</td>
                <td>@item.Quantity</td>
                <td>€@item.MenuItem.ItemPrice.ToString("F2")</td>
                <td>€@item.PriceAccountedForQuantity.ToString("F2")</td>

            </tr>
        }
    </tbody>
</table>
</div>
<div>
    <div>
        <p><strong>Total Amount:</strong> €@Model.TotalAmount.ToString("F2")</p>
        <p><strong>Low VAT (9%):</strong> €@Model.LowVAT.ToString("F2")</p>
        <p><strong>High VAT (21%):</strong> €@Model.HighVAT.ToString("F2")</p>
    </div>
    <div class="PaymentButtons_Container">
        <div class="PaymentButtons_Container">
            <button class="PaymentButtons" data-payment-method="Cash">Cash</button>
            <button class="PaymentButtons" data-payment-method="Maestro">Maestro</button>         
            <button><a href="/Orders/EqualSplitPayment?tableId=@Model.Order.Table.TableNumber">Split Equally</a></button>
            <button><a href="/Orders/MultiPartialPayment?tableId=@Model.Order.Table.TableNumber">Partial Payment</a></button>
             
                      
        </div>
    </div>

    <div class="popupMoveOverlay">
        <div class="popupMoveContainer">
            <div id="PaymentPopUpContainer">
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script>

        $(document).on('click', '.PaymentButtons', function () {
            var paymentMethod = $(this).data('payment-method');
            var tableId = $('#tableId').val();

            $.ajax({
                url: "/Orders/PaymentConfirmationPopup",
                type: "GET",
                data: { tableId: tableId, paymentMethod: paymentMethod },
                success: function (data) {
                    $("#PaymentPopUpContainer").html(data);
                    var overlay = document.getElementsByClassName('popupMoveOverlay')[0];
                    if (overlay) {
                        overlay.style.display = 'block';
                        $(overlay).off('click').on('click', function (e) {
                            if (e.target === overlay) {
                                overlay.style.display = 'none';
                            }
                        });
                    }
                },
                error: function (error) {
                    console.error("Error fetching this View:", error);
                }
            });
        });


        
    </script>
}