@model ChapeauPOS.Models.LoginModel
@{
    ViewData["Title"] = "Login";
    Layout = "~/Views/Shared/_LoginLayout.cshtml";
}
<header>
    <div class="Logo_container">
        <div class="Logo"></div>
        <h2 class="LogoText">ChapeauPOS</h2>
    </div>
    <h1>@ViewData["Title"]</h1>
    <nav class="LoginPage_nav">
        <ul class="navbar-nav flex-grow-1">
            <li class="nav-item">
                <form action="/Home/SetTheme" method="post">
                    <article class="input_group">
                        <label for="Theme">Theme</label>
                        <select onchange="this.form.submit()" id="Theme" name="theme" class="input_field">
                            <option value="">Theme:</option>
                            <option value="Dark">Dark</option>
                            <option value="Light">Light</option>
                        </select>
                    </article>
                </form>
            </li>
        </ul>
    </nav>
</header>

@if(ViewBag.ErrorMessage != null)
{
    <div class="alert alert-danger"> @ViewBag.ErrorMessage</div>
}
@{
    if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger"> @TempData["ErrorMessage"]</div>
    }
}
<div class="LoginPage_body">
    @{
        int employeeIndex = 0;
    }
    @foreach (Employee employee in ViewBag.Employees)
    {
        string employeeIcon = "";
        switch (employee.Role)
        {
            case Roles.Manager:
                employeeIcon = employee.Gender == EmployeeGender.Male ? "ManagerIcon" : "ManagerIconF";
                break;
            case Roles.Waiter:
                employeeIcon = employee.Gender == EmployeeGender.Male ? "WaiterIcon" : "WaitressIcon";
                break;
            case Roles.Bartender:
                employeeIcon = employee.Gender == EmployeeGender.Male ? "BartenderIcon" : "BartenderIconF";
                break;
            case Roles.Cook:
                employeeIcon = employee.Gender == EmployeeGender.Male ? "CookIcon" : "CookIconF";
                break;
        }
        var popupId = $"popupOverlay_{employeeIndex}";
        var loginBtnId = $"loginBtn_{employeeIndex}";
        var cancelBtnId = $"cancelBtn_{employeeIndex}";
    <div class="Login_card">
        <div class="Login_card_body">
            <div class="@employeeIcon"></div>
            <h5 class="card-title">@employee.FirstName @employee.LastName</h5>
            <p class="card-text">Role: @employee.Role</p>
            <a class="conf_button" id="@loginBtnId" href="javascript:void(0);">Login</a>

            <div class="popupOverlay" id="@popupId" style="display:none;">
                <div class="popupContainer">
                    <div class="popupHeader">
                        <h2>Welcome</h2>
                    </div>
                    <div class="Login_card">
                        <div class="Login_card_body">
                            <div class="@employeeIcon"></div>
                            <h5 class="card-title">@employee.FirstName @employee.LastName</h5>
                            <p class="card-text">@employee.Role</p>
                        </div>
                    </div>
                    <form action="/Home/Login" method="POST">
                        <article class="form-group">
                            <input type="hidden" name="EmployeeID" value="@employee.EmployeeId" required />
                        </article>
                        <article class="form-group">
                            <div class="Password_input_Wrap">
                                <input class="Password_input form-control" type="password" name="Password" required placeholder="Enter password... " />
                            </div>
                        </article>
                        <div class="Login_popup_Buttons_Wraps">
                            <button type="button" class="confirmation_cancelation" id="@cancelBtnId">Cancel</button>
                            <button type="submit" class="conf_button">Login as @employee.FirstName</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    employeeIndex++;
    }
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const count = @ViewBag.Employees.Count;
        for (let i = 0; i < count; i++) {
            const loginBtn = document.getElementById(`loginBtn_${i}`);
            const popup = document.getElementById(`popupOverlay_${i}`);
            const cancelBtn = document.getElementById(`cancelBtn_${i}`);
            if (loginBtn && popup) {
                loginBtn.addEventListener("click", function () {
                    popup.style.display = "block";
                });
            }
            if (cancelBtn && popup) {
                cancelBtn.addEventListener("click", function (e) {
                    e.preventDefault();
                    popup.style.display = "none";
                });
            }
        }
    });
</script>
